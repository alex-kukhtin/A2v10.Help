<div>
	<!--title:Шаблони. Події-->
	<!--keywords:events;Події;-->
	<div class="title">
		<h1>
			Шаблони. Події
		</h1>
		<div class="breadcrumb">
			<a href="index">Шаблони</a>
		</div>
	</div>

	<p>
		Об'єкт, що описує події в шаблоне, є звичайним об'єктом JavaScript.
		Імена властивостей цього об'єкта є іменами подій, а значення - функціями, які будуть викликані при виникненні події.
	</p>

	<p>
		Імена подій формуються різними способами в залежності від типу події:
		<ul class="std">
			<li>для всієї моделі імена фіксовані.</li>
			<li>для події створення об'єкту формуються з типу об'єкта і суфіксу <code class="string">.constuct</code>.</li>
			<li>для подій змінення даних з повного шляху до елементу даних і заданного суфіксу.</li>
		</ul>
	</p>

	<p>
		Повний шлях до елементу даних фактично являє собою повне ім'я властивості об'єкта, починаючи від кореня моделі. Для вказання
		елементу масиву використовується суфікс <code>[]</code>.
	</p>

	<p>
		Синтаксис:
<pre class="code-highlight js" data-lang="js">
<script type="text/template">
const tempate = {
  events: {
    'Model.load': (this: IRoot, root: IRoot, caller?: IRoot): void,
    'Model.unload': (this: IRoot, root: IRoot): void,
    '{Type}.construct': (this: IRoot, elem: IElement, prop?: string): void,
    '{PropertyName}.change': (this: IRoot, elem?: IElement, newVal?: any, oldVal?: any, prop?:string): void,
    '{PropertyName}.changing': (this: IRoot, elem?: IElement, newVal?: any, oldVal?: any, prop?:string): boolean,
    '{ArrayName}.add': (this: IRoot, array?: IArrayElement, elem?:IElement>): void 
  }
}
</script>
</pre>
	</p>

	<h3>Події для всієї моделі</h3>
	<p>Ці події мають фіксовані імена.</p>
	<ul class="std">
		<li><code>Model.load</code> - модель завантажено.</li>
		<li><code>Model.unload</code> - модель вивантажена. Жодні дії вже неможливі. Частіше за все використовується для відписки 
		від подій глобальної шини подій.</li>
		<li><code>Model.saved</code> - модель збережено.</li>
		<li><code>Model.beforeSave</code> - перед зберіганням.</li>
	</ul>

	<p>
		Аргументи для подій моделі:
		<ul class="params">
			<li><code>this</code> - корінь моделі даних (IRoot).</li>
			<li><code>model</code> - корінь моделі даних (IRoot).</li>
			<li>
				<code>caller</code> - посилання на корінь моделі даних (IRoot) об'єкта, що викликає.
				Наприклад, якщо це модель діалога, то
				<code>caller</code> буде посиланням на модель, з якої цей діалог було викликано.
				Може використовуватися для взаимодії елементом, що викликає.
				Для подій <code>Model.saved</code>, <code>Model.save</code> значення завжди буде
				<code>undefined</code>.
			</li>
		</ul>
	</p>

	<h3>Події для об'єктів</h3>
	<ul class="std">
		<li>
			<code>.construct</code> - об`єкт создан.
			Префікс імені події являє собою ім'я типу об'єкта. В обробнику цієї події можна доповнити
			утворений елемент новими властивостями. Однак, 
			для цього краще використовувати механізм властивостей (<a class="code-link" href="properties">properites</a>).
		</li>
		<li>
			<code>.change</code> - значення властивості змінено.
			Префікс імені події являє собою повний шлях до властивості в моделі даних.
		</li>
		<li>
			<code>.changing</code> - значення властивості буде змінено.
			Префікс імені події являє собою повний шлях до властивості в моделі даних. 
			Є можливість скасувати змінення.
		</li>
	</ul>

	<p>
		Аргументи для події <code>.construct</code>:
		<ul class="params">
			<li><code>this</code> - корінь моделі даних (IRoot).</li>
			<li><code>elem</code> - створений елемент.</li>
			<li><code>prop</code> - ім'я властивості батьківського елементу, якому буде присвоєний створений об'єкт. Має 
			сенс для обробників створення елементів в <code>MapObject</code>.</li>
		</ul>

		Аргументи для подій <code>.changing</code>, <code>.change</code>:
		<ul class="params">
			<li><code>this</code> - корінь моделі даних (IRoot).</li>
			<li><code>elem</code> - елемент.</li>
			<li><code>newValue</code> - нове значення властивості.</li>
			<li><code>oldValue</code> - старе значення властивості.</li>
			<li><code>prop</code> - ім'я властивості, що змінюється.</li>
		</ul>

		Значення, що повертається, має сенс тільки для події <code>.changing</code>:

		<ul class="params">
			<li>
				<code>Boolean</code> - суворе значення <code>false</code>. Скасовує спробу змінення значення властивості. Будь-яке інше
				значення дозволяє змінення.
			</li>
		</ul>

		<div class="tip warning">
			<b>Зверніть увагу!</b> При зміненні значень об'єктних властивостей, обидва значення властивості (і старе і нове) будуть вказувати
			на один і той самий об'єкт. Це відбувається тому, що об`єкт ніколи не створюється повторно, а просто перезаписуються його властивості.
		</div>
	</p>

	<h3>Події для масивів</h3>
	<p>Префікс імені для всіх подій масивів являє собою повний шлях до властивості в моделі.</p>
	<ul class="std">
		<li><code>[].adding</code> - перед добавленням елементу в масив.</li>
		<li><code>[].add</code> - елемент добавлено в масив.</li>
		<li><code>[].change</code> - змінено елемент масива.</li>
		<li><code>[].remove</code> - елемент видалено з масива.</li>
		<li><code>[].select</code> - елемент масива вибрано.</li>
	</ul>
	<p class="tip warning">
		<b>Зверніть увагу!</b> Події будуть генеруватися тільки тоді, коли для маніпуляції з масивами використовуються засоби платформи.
		Якщо масив змінюється стандартними методами (наприклад <code>push</code>, <code>splice</code>), то події генеруватися не будуть.
	</p>

	<p>
		Аргументи для подій масивів:
		<ul class="params">
			<li><code>this</code> - корінь моделі даних (IRoot).</li>
			<li><code>arr</code> - масив, що змінюється.</li>
			<li><code>elem</code> - новий або видалений елемент.</li>
		</ul>
		Значення, що повертається, має сенс тільки для події <code>.adding</code>.
		<ul class="params">
			<li><code>Boolean</code> - суворе значення <code>false</code>. Відміняє операцію додавання елементу в масив.</li>
		</ul>
	</p>


	<h3>Користувацькі події</h3>
	<p>Описані вище події є вбудованими. Однак, ніхто не забороняє використовувати власні події, які можуть більш 
	точно описувати бізнес-логіку програми.</p>
	<p>
		Такі події генеруються методом <a class="code-link" href="/client/data">$emit</a> кореневого об'єкта (IRoot) і можуть мати 
		довільне ім'я (звісно, воно не може співпадати з системними іменами). Методом <code>$emit</code> також можна генерувати 
		і системніе події.
	</p>

	<p class="tip warning">
		<b>Зверніть увагу!</b> Модель подій в системі пов'язана з даними, а не з елементуми користувацького інтерфейса.
		Іншими словами, події виникають тоді, коли змінюються дані. Виникнення подій жодним чином не пов'язане з користувацьким
		інтерфейсом. Фактично, користувацького інтерфейса може не бути взагалі.
	</p>
</div>