<div>
	<!--title:Шаблони. Валидаторы-->
	<!--keywords:validators;Валидаторы;-->
	<div class="title">
		<h1>
			Шаблони. Валидаторы
		</h1>
	</div>
	<p>
		Валидаторы - механізм, обеспечивающий перевірку достоверности моделі. Зверніть увагу,
		что валидаторы, як і всі остальное в шаблонах связываются с даними, а не с пользовательским інтерфейсом.
		Елементы керування сами отслеживают правильность даних і выводят соответствующие повідомлення об ошибках.
	</p>
	<p>
		Об'єкт, що описує валидаторы являє собою звичайний об`єкт JavaScript. Імена властивостей представляют
		собой шлях до елементу даних в моделі (к тому об'єкту, перевірку якого потрібно выполнить). Якщо в пути к
		данным встречается масив, то соответствующее властивість отмечается суфіксом <code>[]</code>. Например,
		валидатор к властивості <code>Sum</code> строки документа буде мати ім'я<code>Document.Rows[].Sum</code>.
	</p>

	<h3>Синтаксис</h3>
<pre class="code-highlight js">
<script type="text/template">
<![CDATA[
/* валидаторы */

declare const enum ~Severity {
	error   = 'error', /*default value*/
	warning = 'warning',
	info    = 'info'
}

declare const enum ~StdValidator {
	notBlank = 'notBlank',
	email    = 'email',
	url      = 'url',
	isTrue   = 'isTrue',
	regExp   = 'regExp'
}

declare type templateValidatorResult = { msg: string, severity: ~Severity };

interface ~tempateValidatorFunc { (elem: IElement, value?: any): boolean | string | templateValidatorResult | Promise<any>; }

interface ~templateValidatorObj {
	valid: ~tempateValidatorFunc | ~StdValidator,
	async?: boolean,
	msg?: string,
	regExp?: RegExp,
	severity?: ~Severity,
	applyIf?: (elem: IElement, value?: any) => boolean
}

declare type ~templateValidator = String | ~tempateValidatorFunc | ~templateValidatorObj;

validators: {
  [prop: string]: ~templateValidator | ~templateValidator[]
}
]]>
</script>
</pre>

	<h3>Опис</h3>
	<p>
		Значенням валидатора може бути як один валидатор, так і масив валидаторов.
		Якщо це масив, то применяются всі валидаторы з масива.
	</p>
	<p>
		Кожен валидатор (єдиний, або елемент масива) може бути рядком, функцией або об'єктом заданной структуры.
		Основным видом валидатора является об'єкт. Остальные значення - просто сокращенная запись для об'єкта.
	</p>

	<h3>Властивості об'єкта валидатора</h3>
	<ul class="params">
		<li><code>valid</code> - рядок (стандартний валидатор) або функція перевірки.</li>
		<li>
			<code>async</code> - необов'язково. Валидатор является асинхронным (см. ниже).
		</li>
		<li>
			<code>msg</code> - повідомлення об ошибке. Функція перевірки може повернути строку а не булево значення. В цьому випадку значення
			цього властивості ігнорується.
		</li>
		<li>
			<code>severity</code> - серьезность ошибки. За замовчанням - <code>'error'</code>. Влияет на зовнішній вид повідомлення и
			може бути використано в коде.
		</li>
		<li>
			<code>regExp</code> - регулярное вираз для стандартного валидатора типа <code>'regExp'</code>.
		</li>
		<li>
			<code>applyIf</code> - функція, определяющая потрібно ли применять валидатор.
		</li>
	</ul>

	<h3>Стандартні валидаторы</h3>
	<p>Якщо значення властивості <code>valid</code> строка, то це стандартний валидатор. Можливі значення:</p>
	<ul class="params">
		<li><code>'notBlank'</code> - значення не пустое.</li>
		<li>
			<code>'email'</code> - значення являє собою корректный (синтаксически) адрес електронної пошти.
		</li>
		<li>
			<code>'url'</code> -  значення являє собою корректный (синтаксически) web-адрес.
		</li>
		<li>
			<code>'isTrue'</code> - значення точно дорівнює <code>true</code>.
		</li>
		<li>
			<code>'regExp'</code> - значення відповідає регулярному выражению. В цьому випадку повинно бути задано властивість <code>'regExp'</code>.
		</li>
	</ul>


	<h3>Валидатор - строка</h3>
	<p>
		Якщо валидатор - строка, то це проверка значення на пустоту. Сама рядок буде повідомленням об ошибке. Це еквівалент
		об'єкта
		<pre class="code-highlight js">
<script type="text/template">
{valid:'notBlank', msg:'заданная строка', severity=~Severity.error}
</script>
</pre>
	</p>
	<h3>Валидатор - функція</h3>
	<p>
		Якщо валидатор - функція, то це еквівалент об'єкта
<pre class="code-highlight js">
<script type="text/template">
{valid:func, severity=~Severity.error'}
</script>
</pre>
	</p>

	<h3>Формат функції валидации</h3>
	<div class="method">
		<div class="syntax"><pre class="code-highlight js">valid(elem: IElement, value?: any): boolean | string | Promise;</pre></div>
		<h4>Аргументи:</h4>
		<ul class="params">
			<li>
				<code>elem</code> - елемент, до якого застосовується валидатор.
			</li>
			<li>
				<code>val</code> - проверяемое значення.
			</li>
		</ul>
		<h4>Повертає:</h4>
		<ul class="params">
			<li><code>true</code> - якщо значення правильное. </li>
			<li><code>false</code> - якщо значення неправильное. </li>
			<li>
				<code>string</code> - повідомлення об ошибке, якщо значення неправильное. Ця рядок буде замещать значення властивості <code>'msg'</code>.
				Якщо валидатор объявлен як функція, то вона завжди повинна возвращать строку (значення <code>msg</code> в цьому випадку просто нет).
			</li>
			<li>
				<code>об`єкт templateValidatorResult</code> - об'єкт, определяющий повідомлення об ошибке (<code>msg</code>)
				и степень ее серьезности (<code>severity</code>).
			</li>
			<li><code>Promise</code> - для асинхронного валидатора. Проміс повинен повернути булево значення або строку.</li>
		</ul>
	</div>

	<h3>Формат функції <code>applyIf</code></h3>
	<div class="method">
		<div class="syntax"><pre class="code-highlight js">applyIf?: (elem: IElement, value?: any): boolean</pre></div>
		<h4>Аргументи:</h4>
		<ul class="params">
			<li>
				<code>elem</code> - елемент, до якого застосовується валидатор.
			</li>
			<li>
				<code>val</code> - проверяемое значення.
			</li>
		</ul>
		<h4>Повертає:</h4>
		<ul class="params">
			<li><code>true</code> - якщо валидатор активен і його потрібно применять. </li>
		</ul>
	</div>

	<h3>Асинхронные валидаторы</h3>
	<p>
		Асинхронные валидаторы використовуються у випадку, когда для перевірки правильности потрібно обратиться к серверу. Такой валидатор
		отмечается властивістю <code>async: true</code>.
	</p>
	<p>
		Функція валидации для асинхронного валидатора повинна повернути <code>Promise</code>, значенням якого буде або булево значення,
		либо рядок (как і в обычной функції валидации).
	</p>
	<p>Асинхронный валидатор обычно использует метод контролера <a href="/client/controller">$asyncValid</a>.</p>

	<p class="tip warning">
		<b>Зверніть увагу!</b> Возвращаемые значення для асинхронных валидаторов кешируются для предотвращения
		слишком частых обращений к серверу. Фактично валидатор викликається тільки один раз при каждом изменении связанных з ним значений.
	</p>

</div>